---
layout: post
title: Flow Models
description:
date: 2025-08-18 16:40:16
tags: ComputerVision GenerativeAI
image: img/postbanners/2024-08-07-convert-datetime2-bigint.png
---


Perfect place to start a blog on **flow-based generative models**: by grounding everything in the **continuity equation** and then showing how **probability paths**, **velocity fields**, and **flows** connect together. Letâ€™s go step by step with the math.



# 1. The Continuity Equation (Conservation of Probability)

In probability flow models, we think of a distribution of particles (data points) moving through space over time. Probability mass must be conserved â€” it cannot disappear or be created. This is captured by the **continuity equation**:

$$
\frac{\partial}{\partial t} p_t(x) + \nabla_x \cdot \big( p_t(x) \, u_t(x) \big) = 0.
$$

* $p_t(x)$: probability density at time $t$.
* $u_t(x)$: **velocity field** that tells how points at location $x$ move at time $t$.
* $\nabla_x \cdot$: divergence operator.

ðŸ‘‰ Intuition: the rate of change of probability at $x$ is exactly the negative of the probability flux leaving $x$.

This is the **conservation of probability law**, and itâ€™s the foundation for flow-based models.



# 2. Probability Path

We want to transform one distribution into another (e.g., noise â†’ data).
A **probability path** is a smooth family of densities:

$$
\{ p_t(x) \}_{t \in [0,1]}, \quad p_0(x) = p_\text{source}(x), \; p_1(x) = p_\text{target}(x).
$$

So:

* At $t=0$, you have a source distribution (e.g., Gaussian noise).
* At $t=1$, you have the target distribution (e.g., data).
* For $0<t<1$, you interpolate smoothly between them.



# 3. Velocity Field

The **velocity field** $u_t(x)$ describes how each point in space moves over time along the probability path.

For a particle trajectory $X_t$:

$$
\frac{d}{dt} X_t = u_t(X_t).
$$

So if you know the velocity field, you know exactly how samples move from $p_0$ to $p_1$.



# 4. Flow

A **flow** is the mapping that transports particles along this velocity field:

$$
\Phi_t : x_0 \mapsto x_t,
$$

where $\Phi_t$ is the solution of the ODE:

$$
\frac{d}{dt} x_t = u_t(x_t), \quad x_0 \sim p_0.
$$

* The **flow of particles** generated by the velocity field induces the **flow of probability distributions** $p_t$.
* Together, the continuity equation guarantees that when particles move via $u_t$, the probability density evolves exactly as $p_t$.



# 5. Interconnection

Putting it all together:

1. **Continuity equation**

   $$
   \frac{\partial}{\partial t} p_t(x) = -\nabla_x \cdot (p_t(x) \, u_t(x)).
   $$

2. **Trajectory definition**

   $$
   \frac{d}{dt} X_t = u_t(X_t).
   $$

3. **Probability path consistency**

   $$
   \{X_t\}_{t\in[0,1]} \;\;\Rightarrow\;\; \{p_t(x)\}_{t\in[0,1]}.
   $$

**Interpretation:**

* The **probability path** says â€œhow densities change in time.â€
* The **velocity field** says â€œhow individual points move in time.â€
* The **flow** is the global transformation mapping source samples to target samples.
* The **continuity equation** mathematically links them so that if each particle follows $u_t(x)$, the density changes consistently as $p_t(x)$.

